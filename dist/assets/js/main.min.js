import"./firebase.min.js";import{getDatabase,ref,set,child,get}from"https://www.gstatic.com/firebasejs/9.8.4/firebase-database.js";import QrScanner from"./qr-scanner.min.js";const form=document.querySelector("#registerForm"),stepProgress=document.querySelectorAll(".step"),formStep=document.querySelectorAll(".form-step"),snapShot=document.querySelector("#take-snapshot"),savePhoto=document.querySelector("#save-photo"),retakePhoto=document.querySelector("#retake-photo"),backBtnInformation=document.querySelector("#back-information"),backBtnIdentity=document.querySelector("#back-identity"),submitBtn=document.querySelector("#submit-btn"),openScan=document.querySelector("#open-scanner"),closeScan=document.querySelector("#close-scanner");let active=1;const paths={index:"index.html",register:"register.html",download:"download.html",result:"result.html"},{index:index,register:register,download:download,result:result}=paths,idle=()=>{let e=0,t=setInterval((()=>{e+=1,120===e&&(clearInterval(t),window.location.reload())}),1e3);document.addEventListener("mousemove",(()=>e=0)),document.addEventListener("keydown",(()=>e=0))},generateID=()=>`${(new Date).getFullYear()}-${Math.random().toString(36).slice(-5)}`,generateQRCode=()=>{new QRCode(document.querySelector("#qrcode"),Storage.getRegisteredUser().userID),document.querySelector("#qr-name").innerHTML=`${Storage.getRegisteredUser().firstName.toUpperCase()} ${Storage.getRegisteredUser().lastName.toUpperCase()}`},displayErrMsg=(e,t)=>{const r=document.createElement("div");r.classList.add("invalid-feedback"),r.innerHTML=e,t.classList.add("invalid"),t.focus(),t.nextElementSibling.after(r)},resetErrMsg=()=>{document.querySelectorAll(".invalid-feedback").forEach((e=>e.remove())),document.querySelectorAll(".form-control").forEach((e=>e.classList.remove("invalid")))},nextStep=()=>{active++,active>stepProgress.length&&(active=stepProgress.length),updateProgress()},prevStep=()=>{active--,active<1&&(active=1),updateProgress()},updateProgress=()=>{stepProgress.forEach(((e,t)=>{t===active-1?(e.classList.add("active"),formStep[t].hidden=!1,formStep[t].classList.add("active")):(e.classList.remove("active"),formStep[t].classList.remove("active"),formStep[t].hidden=!0)}))},openWebcam=()=>{Webcam.set({width:320,height:240,image_format:"jpeg",jpeg_quality:90,flip_horiz:!0}),Webcam.attach("#camera")},offWebcam=()=>Webcam.reset(),scanQr=()=>{const e=document.querySelector("#qr-video");e.hidden=!1;const t=new QrScanner(e,(e=>ProfileImage.readUser(e.data)),{highlightScanRegion:!0,highlightCodeOutline:!0});return t};class User{constructor(e,t,r,a){this.userID=e,this.firstName=t,this.lastName=r,this.email=a}}class ProfileImage extends User{constructor(e,t,r,a,s){super(e,t,r,a),this.image=s}addUser(){const e=getDatabase(),t=ref(e,`users/${this.userID}`);set(t,{firstName:this.firstName,lastName:this.lastName,email:this.email,image:this.image}).then((()=>window.location.href=download)).catch((e=>console.error(e)))}static readUser(e){const t=getDatabase(),r=ref(t);get(child(r,`users/${e}`)).then((e=>{if(e.exists()){const t=e.val();Storage.setResult(t)}else{const t=e.val();Storage.setResult(t),window.location.href=result}})).catch((e=>console.error(e)))}}class Storage{static setRegisteredUser(e){localStorage.setItem("user",JSON.stringify(e))}static getRegisteredUser(){const e=JSON.parse(localStorage.getItem("user"));if(null!==e)return e}static checkRegisteredUser(){null===JSON.parse(localStorage.getItem("user"))&&(window.location.href=register)}static setResult(e){localStorage.setItem("result",JSON.stringify(e))}static getResult(){return JSON.parse(localStorage.getItem("result"))}}if(form&&(form.addEventListener("submit",(e=>{e.preventDefault();const t=document.querySelector("#firstName"),r=document.querySelector("#lastName"),a=document.querySelector("#email");let s;if(""===t.value||0===t.value.length)resetErrMsg(),s="Please enter your first name.",displayErrMsg(s,t);else if(""===r.value||0===r.value.length)resetErrMsg(),s="Please enter your last name.",displayErrMsg(s,r);else if(""===a.value||0===a.value.length)resetErrMsg(),s="Please enter your email address.",displayErrMsg(s,a);else{resetErrMsg();const e=new User(`${(new Date).getFullYear()}-${Math.random().toString(36).slice(-5)}`,t.value,r.value,a.value);Storage.setRegisteredUser(e),form.reset(),nextStep(),openWebcam()}})),snapShot&&Webcam.on("live",(()=>{snapShot.addEventListener("click",(()=>{Webcam.freeze(),snapShot.hidden=!0,backBtnInformation.hidden=!0,savePhoto.hidden=!1,retakePhoto.hidden=!1}))})),savePhoto&&savePhoto.addEventListener("click",(()=>{Webcam.snap((e=>{const t=new ProfileImage(Storage.getRegisteredUser().userID,Storage.getRegisteredUser().firstName,Storage.getRegisteredUser().lastName,Storage.getRegisteredUser().email,e);Storage.setRegisteredUser(t),document.querySelector("#avatar").src=e,document.querySelector("#first-name").innerHTML=Storage.getRegisteredUser().firstName,document.querySelector("#last-name").innerHTML=Storage.getRegisteredUser().lastName,document.querySelector("#email-add").innerHTML=Storage.getRegisteredUser().email})),offWebcam(),nextStep()})),retakePhoto&&retakePhoto.addEventListener("click",(()=>{Webcam.unfreeze(),savePhoto.hidden=!0,retakePhoto.hidden=!0,snapShot.hidden=!1,backBtnInformation.hidden=!1})),backBtnInformation&&backBtnInformation.addEventListener("click",(()=>{firstName.value=Storage.getRegisteredUser().firstName,lastName.value=Storage.getRegisteredUser().lastName,email.value=Storage.getRegisteredUser().email,prevStep(),offWebcam()})),backBtnIdentity&&backBtnIdentity.addEventListener("click",(()=>{prevStep(),openWebcam(),savePhoto.hidden=!0,retakePhoto.hidden=!0,snapShot.hidden=!1,backBtnInformation.hidden=!1})),submitBtn&&submitBtn.addEventListener("click",(()=>{new ProfileImage(Storage.getRegisteredUser().userID,Storage.getRegisteredUser().firstName,Storage.getRegisteredUser().lastName,Storage.getRegisteredUser().email,Storage.getRegisteredUser().image).addUser()}))),openScan&&openScan.addEventListener("click",(()=>{document.querySelector("#illustration").hidden=!0,openScan.hidden=!0,closeScan.hidden=!1,scanQr().start(),idle()})),closeScan&&closeScan.addEventListener("click",(()=>window.location.reload())),window.location.pathname===`/${download}`){Storage.checkRegisteredUser(),new QRCode(document.querySelector("#qrcode"),Storage.getRegisteredUser().userID),document.querySelector("#qr-name").innerHTML=`${Storage.getRegisteredUser().firstName.toUpperCase()} ${Storage.getRegisteredUser().lastName.toUpperCase()}`;document.querySelector("#download-qr").addEventListener("click",(()=>{html2canvas(document.querySelector("#qr-code-wrapper")).then((e=>{const t=e.toDataURL(),r=`${Storage.getRegisteredUser().firstName} ${Storage.getRegisteredUser().lastName}.jpg`,a=document.createElement("a");"string"==typeof a.download?(a.href=t,a.download=r,document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(t),localStorage.removeItem("user"),window.location.href=index}))}))}window.location.pathname===`/${result}`&&(null===Storage.getResult()?document.querySelector('[data-result="failed"]').hidden=!1:document.querySelector('[data-result="success"]').hidden=!1);
//# sourceMappingURL=main.min.js.map